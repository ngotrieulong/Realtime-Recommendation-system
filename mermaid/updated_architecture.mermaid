flowchart TB
    %% =============================================
    %% ğŸ¬ REAL-TIME MOVIE RECOMMENDATION SYSTEM
    %% =============================================

    subgraph CLIENT["ğŸ–¥ï¸ CLIENT LAYER"]
        direction TB
        User([ğŸ‘¤ User / Browser])
        React["âš›ï¸ React Frontend<br/>(Port 3000)"]
    end

    subgraph GATEWAY["ğŸ›¡ï¸ GATEWAY LAYER (Port 80)"]
        Nginx["ğŸŒ NGINX API Gateway<br/>Rate Limiting, Security, Routing"]
    end

    subgraph SERVING["ğŸš€ SERVING LAYER (Online)"]
        direction TB
        FastAPI["âš¡ FastAPI Server<br/>(Port 8000)"]
        Redis[("ğŸ”´ Redis<br/>L1 Cache")]
        Postgres[("ğŸ˜ PostgreSQL<br/>L2 Hot Data & Recs")]
    end

    subgraph SPEED["âš¡ SPEED LAYER (Real-Time)"]
        direction TB
        Kafka["ğŸ“¨ Kafka<br/>Event Stream"]
        SparkStream["ğŸ”¥ Spark Streaming<br/>Micro-batch 5s"]
    end

    subgraph BATCH["ğŸ”„ BATCH LAYER (Historical)"]
        direction TB
        MinIO[("ğŸª£ MinIO Data Lake<br/>Archived Events")]
        Airflow["ğŸƒ Airflow Scheduler<br/>Daily 2 AM"]
        SparkBatch["ğŸ”¨ Spark Batch Job<br/>ALS Model Training"]
    end

    %% Client Interactions
    User -->|Interacts| React
    React -->|HTTP Requests| Nginx

    %% Gateway Routing
    Nginx -->|/api/*| FastAPI
    Nginx -->|/admin/*| Airflow
    Nginx -->|/storage/*| MinIO

    %% Serving Logic
    FastAPI -->|1. Check Cache| Redis
    Redis -.->|Miss| Postgres
    FastAPI -->|2. Query Hot Data| Postgres
    FastAPI -->|3. Publish Events| Kafka

    %% Speed Layer Flow
    Kafka -->|Consume| SparkStream
    SparkStream -->|Update Vectors| Postgres
    SparkStream -->|Log Raw Events| MinIO

    %% Batch Layer Flow
    Airflow -->|Trigger| SparkBatch
    MinIO -->|Read History| SparkBatch
    SparkBatch -->|Save Model| MinIO
    SparkBatch -->|Update Bulk Recs| Postgres

    %% Styling
    style CLIENT fill:#f9f9f9,stroke:#333,stroke-width:2px
    style GATEWAY fill:#e1bee7,stroke:#8e24aa,stroke-width:2px
    style SERVING fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px
    style SPEED fill:#bbdefb,stroke:#0d47a1,stroke-width:2px
    style BATCH fill:#ffe0b2,stroke:#f57c00,stroke-width:2px
